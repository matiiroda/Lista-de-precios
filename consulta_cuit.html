<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Consulta Masiva de CUITs</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h2>Consulta Masiva de CUITs</h2>
  <p>Subí un archivo CSV con los CUITs, uno por línea.</p>
  <input type="file" id="fileInput" accept=".csv">
  <button onclick="procesarArchivo()">Consultar CUITs</button>

  <table id="resultados">
    <thead>
      <tr>
        <th>CUIT</th>
        <th>Razón Social</th>
        <th>Dirección</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    async function consultarCuit(cuit) {
      try {
        const response = await fetch(`https://api.cuitonline.com/cuit/${cuit}`);
        const data = await response.json();
        return {
          cuit: cuit,
          razon_social: data.razon_social || 'No disponible',
          direccion: data.direccion || 'No disponible'
        };
      } catch (err) {
        return { cuit, razon_social: 'Error', direccion: 'Error' };
      }
    }

    function procesarArchivo() {
      const input = document.getElementById('fileInput');
      const file = input.files[0];
      if (!file) {
        alert('Seleccioná un archivo CSV primero.');
        return;
      }

      const reader = new FileReader();
      reader.onload = async function(e) {
        const lineas = e.target.result.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
        const tbody = document.querySelector('#resultados tbody');
        tbody.innerHTML = '';

        for (const cuit of lineas) {
          const resultado = await consultarCuit(cuit);
          const fila = document.createElement('tr');
          fila.innerHTML = `
            <td>${resultado.cuit}</td>
            <td>${resultado.razon_social}</td>
            <td>${resultado.direccion}</td>
          `;
          tbody.appendChild(fila);
        }
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
